---
name: mp-weixin-skills
description: 使用此 skill 将 Markdown/Word/PDF 文档转换为微信公众号格式并发布到草稿箱
---

# 微信公众号文章发布管理 Skill

## Overview

这是一个专门用于管理微信公众号文章发布的 Skill。当你需要将文章发布到微信公众号草稿箱时，此 Skill 会：

1. **首先要求 AI 将文章转换为微信公众号格式的 HTML**
2. **然后使用 Python 脚本上传素材和创建草稿**

**核心原则：**
- **AI 负责**：文档转换（Markdown/Word/PDF → 微信公众号 HTML）
- **Skill 负责**：微信 API 操作（上传素材、草稿管理）

## When to Use

- 需要将文章发布到微信公众号草稿箱
- 需要更新已有的草稿内容
- 需要上传图片素材到微信素材库

**使用前准备:**
1. 配置微信公众号 API 凭证（AppID 和 AppSecret）
2. 配置服务器 IP 白名单
3. 准备好要发布的文章源文件（.md/.docx/.pdf）

---

## 工作流程

### 完整发布流程

```
┌─────────────────────────────────────────────────────────┐
│                    第一步：AI 文档转换                    │
├─────────────────────────────────────────────────────────┤
│  Claude AI 收到任务后，会：                               │
│  1. 读取文章内容（Markdown/Word/PDF）                        │
│  2. 按照 SKILL.md 中的规范转换为 HTML                      │
│  3. 应用微信公众号样式规范（标题、段落、列表等）             │
│  4. 生成符合微信阅读体验的完整 HTML                       │
│                                                             │
│  输出：带有内联样式的 HTML 字符串                          │
└─────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────┐
│                第二步：微信草稿管理（本 Skill）             │
├─────────────────────────────────────────────────────────┤
│  1. 接收 AI 生成的 HTML                                   │
│  2. 生成封面图片（模板生成或使用 AI 生成的图片）         │
│  3. 上传封面到微信素材库                                     │
│  4. 调用微信公众号 API 创建草稿                           │
│  5. 返回草稿 media_id 用于后续更新                          │
│                                                             │
│  核心功能：                                                   │
│  - 上传素材到微信素材库（通过 API）                         │
│  - 创建新草稿                                                 │
│  - 更新已有草稿                                               │
│  - API 调用重试和错误处理                                     │
└─────────────────────────────────────────────────────────┘
```

### 为什么这样设计？

| 优势 | 说明 |
|------|------|
| **职责分离** | AI 擅长内容理解和样式应用，脚本专注 API 操作 |
| **质量更高** | AI 能理解语义，生成更符合公众号风格的内容 |
| **维护简单** | 不需要维护复杂的文档解析逻辑，脚本只做 API 调用 |
| **灵活扩展** | 可以轻松更换 AI 提供商或转换方式 |
| **持续改进** | AI 能力持续提升，无需重新部署脚本 |

---

## 公众号平台特征

### 用户画像
* **用户群广泛**：覆盖各年龄段，以25-50岁为主
* **阅读场景**：碎片时间、通勤路上、睡前
* **内容偏好**：深度文章、干货分享、观点输出
* **互动习惯**：转发有共鸣的内容、在看、评论

### 内容调性
* **正式感**：比社交媒体正式，比论文亲切
* **深度感**：有观点、有论据、有思考
* **排版感**：注重视觉效果和阅读体验
* **品牌感**：统一的风格和调性

---

## 转换规则

### 0. 内容保留原则
**在开始任何转换之前，必须完整保留原内容中的：**
* **所有图片**：保留原图片的 Markdown 语法和路径
* **图片说明文字**：保留图片下方或上方的说明文字

### 1. 标题优化

**公众号标题特点：**
* 信息完整，不玩悬念
* 可以较长（不超过64字符）
* 体现文章价值
* 可用分隔符号

**转换示例：**

| 原标题 | 公众号标题 |
| --- | --- |
| AI写作工具评测 | 深度测评：2026年最值得用的5款AI写作工具 |
| 程序员效率方法 | 十年老程序员的效率心得：这些方法帮我每天早下班2小时 |
| Python入门指南 | 写给零基础的Python学习路线（附完整资源） |

**常用标题格式：**
* 深度/干货/实操 + 主题 + 价值点
* 身份 + 经验 + 分享内容
* 主题 + 补充说明（括号内）

### 2. 开头格式

**公众号风格开头：**
* 可以有引导语/导语
* 建立阅读期待
* 适当的个人化表达

**常用开头模板：**

**模板一：引子式**
```markdown
最近[某现象/某话题]很火，朋友圈里到处都在讨论。
作为[某身份]，我想从[某角度]聊聊这件事。
全文X字，阅读约需X分钟。
```

**模板二：问题式**
```markdown
你有没有遇到过这样的情况？
[描述共鸣场景]
今天这篇文章，就来聊聊[主题]。
```

**模板三：直入式**
```markdown
先说结论：[核心观点]
理由有三，下面展开讲。
```

### 3. 正文结构

**公众号偏好的结构：**
* 层次分明的大纲结构
* 每节有小标题
* 段落适中（3-5句）
* 适当使用引用块

**格式规范：**
```markdown
## 一、第一个章节
正文内容...
> 引用或金句
正文内容...
### 1.1 小节（可选）
...
---
## 二、第二个章节
...
```

### 4. 视觉元素

**分隔线使用：**
```markdown
---
```

**引用块使用场景：**
* 金句强调
* 他人观点引用
* 重要提示
* 数据来源说明

```markdown
> "这是一句需要强调的话。"
> 💡 小贴士：这里是补充说明...
> 📊 数据来源：艾瑞咨询《2025年XX报告》
```

**图片使用规范：**
* 每800-1000字配一张图
* 图片要有说明文字
* 保持风格统一

```markdown
![图片说明](image.jpg)
_图注：简短的图片说明_
```

### 5. 文字样式

**加粗使用：**
* 关键概念首次出现
* 重要结论
* 不要整段加粗

**示例：**
```markdown
这里有一个**重要概念**需要理解。
研究表明，**高效学习需要适当间隔**，而不是集中突击。
```

**斜体使用：**
* 英文术语
* 书名影名
* 较少使用

### 6. 结尾格式

**公众号风格结尾：**
* 总结核心观点
* 升华或延伸思考
* 引导互动
* 推荐相关阅读（可选）

**模板：**
```markdown
---
**写在最后**
[总结性段落，可以表达个人观点或呼吁行动]
如果这篇文章对你有帮助，欢迎转发给需要的朋友。
有任何想法，欢迎在评论区交流。
---
**往期推荐**
- [相关文章1](链接)
- [相关文章2](链接)
---
_作者简介_
_[个人介绍]_
_公众号：[账号名]_
```

---

## 风格转换

### 语气调整

| 原风格 | 公众号风格 |
| --- | --- |
| 这个产品很好 | 实际使用下来，这个产品在XX方面表现不错 |
| 大家都知道 | 可能你已经注意到 |
| 一定要这样做 | 建议这样做 / 不妨试试 |
| 总之 | 总的来说 / 综合来看 |
| 完 | （不需要"完"字） |

### 专业与亲切的平衡

**太学术（避免）：**
```markdown
本文旨在探讨AI写作工具的效用问题，通过对市面主流产品进行系统性评估...
```

**太口语（避免）：**
```markdown
今天来唠唠AI写东西这事儿，贼好使你们知道吗...
```

**公众号风格（推荐）：**
```markdown
最近AI写作工具越来越多，到底哪款好用？我用了一个月，来分享一下真实体验。
```

---

## 排版建议

### 段落设置
* 每段3-5句为宜
* 段间留一行空行
* 重要内容独立成段

### 字数建议

| 类型 | 字数范围 |
| --- | --- |
| 短文 | 1500-2500 |
| 中等 | 2500-4000 |
| 长文 | 4000-6000 |
| 深度 | 6000+ |

### 阅读时间提示
在开头或导语中标注：
```markdown
全文约3000字，阅读需要8分钟。
```

---

## 特殊格式

### 卡片引用
用于突出重要信息：
```markdown
> **📌 划重点**
>
> 1. 第一个要点
> 2. 第二个要点
> 3. 第三个要点
```

### 目录导航（长文）
```markdown
**本文目录**
一、章节一
二、章节二
三、章节三
---
```

### 资源汇总
```markdown
**📚 资源汇总**
| 资源名 | 链接 | 说明 |
| ------ | ---- | -------- |
| 资源1 | 链接 | 简要说明 |
| 资源2 | 链接 | 简要说明 |
_（复制到浏览器打开）_
```

---

## 禁忌事项

### 不要做
1. **诱导分享**
* ❌ "不转不是中国人"
* ❌ 过度诱导点赞/在看

2. **标题党**
* ❌ 与内容严重不符的标题
* ❌ 过度夸张的表达

3. **排版问题**
* ❌ 字号过小或过大
* ❌ 颜色过于花哨
* ❌ 没有段落分隔

4. **内容问题**
* ❌ 抄袭搬运
* ❌ 虚假信息
* ❌ 敏感话题不当处理

### 要做
1. **原创深度内容**
2. **清晰的逻辑结构**
3. **舒适的阅读体验**
4. **真诚的表达**
5. **删除没有内容序号行，避免因为 markdown 格式问题导致出现众多空序号行**

---

## 样式规范（自动应用）

### 标题样式

**一级标题（文章标题）- 自动应用：**
- ✅ 主题色渐变背景（从主题色到淡化色）
- ✅ 白色文字，增强对比度
- ✅ 圆角边框（8px）
- ✅ 阴影效果（文字和卡片阴影）
- ✅ 内边距（20px 上下，24px 左右）

**二级标题（章节标题）- 自动应用：**
- ✅ 左侧主题色装饰条（4px）
- ✅ 12px 左内边距
- ✅ 18px 上下外边距

**三级标题（小节）：**
- 默认样式，无装饰

### 段落样式 - 自动应用
- ✅ 颜色：#333333
- ✅ 行高：1.8
- ✅ 外边距：16px 0
- ✅ 字号：16px

### 代码块样式 - 自动应用

**内联代码（行内代码）：**
- ✅ 背景色：#f5f5f5
- ✅ 内边距：2px 6px
- ✅ 圆角：3px
- ✅ 字体：等宽字体（monospace）
- ✅ 字色：#e74c3c（红色高亮）
- ✅ 字号：14px（与正文协调）

**代码块（多行代码）- 移动端友好设计：**
- ✅ 背景色：#f5f5f5
- ✅ 内边距：15px 12px（左右稍小，适应手机屏幕）
- ✅ 圆角：4px
- ✅ 字体：等宽字体（monospace）
- ✅ 字号：13px（手机端可读性最佳）
- ✅ 行高：1.6（代码行间距适中）
- ✅ **横向滚动**：overflow-x: auto（重要！手机端代码过长时可横向滚动）
- ✅ **最大宽度**：max-width: 100%（防止代码块溢出屏幕）
- ✅ **自动换行**：white-space: pre（保留代码格式，允许用户横向滚动查看）
- ✅ **文字不换行**：word-break: normal（保持代码完整性）

**移动端代码块设计要点：**
```
核心原则：
1. 不强制换行破坏代码结构
2. 支持横向滚动查看长代码
3. 触控滑动体验流畅
4. 字体大小在手机上清晰可读
5. 背景对比度适中，不刺眼
```

**推荐代码块 HTML 结构：**
```html
<pre style="
  background-color: #f5f5f5;
  padding: 15px 12px;
  border-radius: 4px;
  overflow-x: auto;
  max-width: 100%;
  font-family: monospace;
  font-size: 13px;
  line-height: 1.6;
  white-space: pre;
  word-break: normal;
  -webkit-overflow-scrolling: touch;
"><code>代码内容</code></pre>
```

**注意事项：**
- ⚠️ 代码块在手机上需要横向滚动，不要强制换行
- ⚠️ 长代码行请考虑在源文件中适当分段
- ✅ 添加 `-webkit-overflow-scrolling: touch` 提升 iOS 滚动体验
- ✅ 代码块宽度设为 100%，确保不超出屏幕宽度

### 引用块样式 - 自动应用
- ✅ 左侧边框：4px 主题色
- ✅ 背景色：#f9f9f9
- ✅ 内边距：10px 15px

### 表格样式 - 自动应用
- ✅ 表头：主题色背景，白色文字
- ✅ 单元格：灰色边框，10px 内边距
- ✅ 边框合并：collapse

---

## 封面图生成

**自动封面规格:**
- 尺寸: 1080×460 (2.35:1)
- 格式: JPEG
- 质量: 95%
- 字体: 华文黑体（支持中文）

### 封面生成方式

**方式 1: 模板生成（默认）**
- 自动使用文章标题生成封面
- 渐变背景（基于主题色）
- 右侧装饰条、左上角几何图形
- 底部装饰线和圆点、文字阴影效果

**方式 2: AI 生成封面（推荐）**
- 使用 Claude AI 或其他 AI 工具生成封面
- 根据文章主题和关键词生成原创设计
- 支持指定风格和元素

**方式 3: 搜索图片二次加工（推荐）**
- 通过互联网搜索与文章主题相关的图片
- 在搜索的图片基础上添加标题文字和装饰元素
- 确保图片版权合规

### 使用 AI 生成或搜索图片的流程

**步骤：**
1. 使用 AI 工具（如 Claude、Midjourney、DALL·E）或图片搜索引擎生成/找到合适的底图
2. 将图片保存到项目目录或提供图片 URL
3. 在发布时，工具会自动在底图上添加：
   - 文章标题（自动截取适应长度）
   - 主题色装饰元素
   - 阴影和视觉增强效果

**示例搜索关键词：**
- 技术类文章：「科技背景 抽象」「数据可视化」「代码编辑器」
- 职场类文章：「办公场景」「商务会议」「团队协作」
- 生活类文章：「自然风景」「城市街景」「温馨家居」

**推荐主题色:**

| 色值 | 适用场景 |
|------|----------|
| `#07c160` | 科技、效率 |
| `#ff6b6b` | 生活、情感 |
| `#4a90e2` | 商业、职场 |
| `#f5a623` | 教育、培训 |
| `#9013fe` | 创意、设计 |

### 封面优化建议

- ✅ 使用高质量图片作为底图（分辨率≥1080px）
- ✅ 选择与文章主题相关的视觉元素
- ✅ 确保标题文字清晰可读
- ✅ 保持品牌色的一致性
- ⚠️ 避免使用版权不明的图片
- ⚠️ 避免过于复杂的背景影响文字识别

---

## 推荐工作流程

**最佳实践：使用 AI 进行文档转换**

```
┌─────────────────────────────────────────────────────────┐
│                    文档转换（AI 处理）                   │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────┐    │
│  │ Markdown   │→ │     AI      │→ │ 微信格式    │    │
│  │  (.md)      │  │  (Claude)    │  │  HTML       │    │
│  └─────────────┘  └──────────────┘  └─────────────┘    │
│                                                              │
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────┐    │
│  │ Word       │→ │ AI/Skill    │→ │ 微信格式    │    │
│  │ (.docx)     │  │ (find-skills)│  │  HTML       │    │
│  └─────────────┘  └──────────────┘  └─────────────┘    │
│                                                              │
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────┐    │
│  │ PDF        │→ │ AI/Skill    │→ │ 微信格式    │    │
│  │ (.pdf)      │  │ (find-skills)│  │  HTML       │    │
│  └─────────────�  └──────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────┐
│              微信公众号操作（Python 脚本）              │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌─────────────┐  ┌─────────────┐   │
│  │ 上传素材      │  │ 创建草稿    │  │ 更新草稿    │   │
│  │ (API 调用)   │  │ (API 调用)   │  │ (API 调用)   │   │
│  └──────────────┘  └─────────────┘  └─────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 为什么这样更好？

1. **AI 转换质量更高**：AI 能理解文档语义，生成更符合微信公众号风格的内容
2. **减少代码维护**：Python 脚本专注于 WeChat API，不需要维护复杂的解析逻辑
3. **更灵活可扩展**：可以使用不同的 AI 或 Skill 处理不同格式
4. **即时更新**：AI 能力持续改进，无需重新部署脚本

### 当前实现说明

**本 Python 脚本提供以下功能：**
- ✅ 微信公众号 API 集成（上传素材、草稿管理）
- ✅ 基础 Markdown 解析（用于快速预览）
- ⚠️ 文档转换：**建议使用 AI 或其他 tools 完成**

**文档转换建议：**
- **Markdown → HTML**：直接使用 Claude AI 转换，并应用微信样式规范
- **Word → HTML**：使用 `find-skills` 找到专门的转换工具
- **PDF → HTML**：使用 `find-skills` 找到专门的转换工具

---

## 文档格式支持（基础实现）

**注意：以下为脚本的基础实现，推荐使用 AI 进行转换**

| 格式 | 扩展名 | 状态 | 推荐方式 |
|------|--------|------|----------|
| Markdown | .md | ✅ 基础支持 | **推荐使用 AI 转换** |
| Word | .docx, .doc | ✅ 基础支持 | 使用 AI 或 find-skills |
| PDF | .pdf | ✅ 基础支持 | 使用 AI 或 find-skills |

---

## Instructions

### 执行命令

**发布文章到微信草稿箱:**

```bash
# 项目根目录执行
python3 .claude/skills/mp-weixin-skills/scripts/cli.py publish <file.md>

# 更新已有草稿
python3 .claude/skills/mp-weixin-skills/scripts/cli.py update <media_id>

# 显示版本
python3 .claude/skills/mp-weixin-skills/scripts/cli.py version
```

**配置要求:**
- 必须在 skills 目录下或者mp-weixin-skills目录下创建 `.env` 文件
- `.env` 文件需要包含以下配置：

```bash
WECHAT_APP_ID=your_app_id
WECHAT_APP_SECRET=your_app_secret
```

**获取 AppID 和 AppSecret:**
1. 登录微信公众平台 https://mp.weixin.qq.com
2. 进入「开发 → 基本配置」
3. 查看「开发者ID (AppID)」和「开发者密码 (AppSecret)」

---

## Command Reference

### publish - 发布文章

```bash
mp-weixin publish <file> [options]
```

**选项:**
- `--template` - 样式模板 (default/modern/classic/tech/minimal)
- `--cover-type` - 封面生成方式 (template)
- `--no-api` - 不使用 API，仅生成 HTML 文件
- `--verbose, -v` - 详细输出

**示例:**
```bash
mp-weixin publish article.md
mp-weixin publish article.md --template modern
mp-weixin publish article.md --no-api
```

### update - 更新草稿

```bash
mp-weixin update <media_id> [options]
```

**选项:**
- `--source` - 指定新的源文件
- `--regenerate-cover` - 重新生成封面

**示例:**
```bash
mp-weixin update <media_id>
mp-weixin update <media_id> --regenerate-cover
mp-weixin update <media_id> --source new-article.md
```

### version - 显示版本

```bash
mp-weixin version
```

---

## Configuration

### 环境变量 (.env)

```bash
# 微信公众号配置（必需）
WECHAT_APP_ID=your_app_id
WECHAT_APP_SECRET=your_app_secret

# 输出配置
OUTPUT_DIR=./output
TEMPLATE_NAME=default
THEME_COLOR=#07c160

# 日志配置
LOG_LEVEL=INFO
LOG_FILE=mp_weixin.log
```

### IP 白名单配置

1. 登录微信公众平台
2. 进入「开发 → 基本配置」
3. 找到「IP 白名单」
4. 添加服务器公网 IP
5. 等待 5-15 分钟生效

---

## Error Handling

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 40001 | AppSecret 错误 | 检查 AppSecret 是否正确 |
| 40164 | IP 不在白名单 | 配置 IP 白名单，等待生效 |
| 45009 | 接口调用超过限制 | 等待限制重置 |

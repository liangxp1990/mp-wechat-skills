# å¾®ä¿¡å…¬ä¼—å·æ–‡ç« å‘å¸ƒå·¥å…· - è®¾è®¡æ–‡æ¡£

**é¡¹ç›®åç§°**: mp-weixin-skills
**åˆ›å»ºæ—¥æœŸ**: 2025-01-29
**ç‰ˆæœ¬**: 1.0
**ä½œè€…**: Claude AI

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ç›®æ ‡

å¼€å‘ä¸€ä¸ªå°† Wordã€PDF æˆ– Markdown æ–‡ä»¶è½¬æ¢ä¸ºç¬¦åˆå¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆè¦æ±‚çš„ HTML å†…å®¹çš„å·¥å…·ï¼Œæ”¯æŒï¼š

1. æ ¹æ®ä¸»é¢˜å†…å®¹ç”Ÿæˆæˆ–è·å–å°é¢å›¾
2. ä¸Šä¼ å°é¢å›¾åˆ°å¾®ä¿¡å…¬ä¼—å·ç´ æåº“
3. å°†æ–‡æ¡£è½¬æ¢ä¸ºå¾®ä¿¡å…¬ä¼—å·æ–‡ç« æ ¼å¼
4. å¤„ç†å¤šåª’ä½“å†…å®¹ï¼ˆå›¾ç‰‡ä¸Šä¼ ï¼‰
5. ä¼˜åŒ–æ’ç‰ˆå¸ƒå±€ï¼Œæä¾›æ ·å¼æ¨¡æ¿
6. é€šè¿‡ API æ¨é€åˆ°è‰ç¨¿ç®±æˆ–æ›´æ–°ç°æœ‰è‰ç¨¿

### 1.2 ç›®æ ‡ç”¨æˆ·

- **ä¸»è¦ç”¨æˆ·**: ä¸ªäººå†…å®¹åˆ›ä½œè€…
- **ä½¿ç”¨åœºæ™¯**: å¿«é€Ÿå°†æœ¬åœ°æ–‡æ¡£å‘å¸ƒåˆ°å¾®ä¿¡å…¬ä¼—å·

### 1.3 æŠ€æœ¯é€‰å‹

- **è¯­è¨€**: Python 3.10+
- **æ¶æ„**: å…¨é›†æˆ CLI å·¥å…·ï¼ˆæ–¹æ¡ˆä¸€ï¼‰
- **ä¾èµ–åº“**:
  - `python-docx` - Word æ–‡æ¡£è§£æ
  - `PyMuPDF` - PDF æ–‡æ¡£è§£æ
  - `markdown-it-py` - Markdown è§£æ
  - `requests` - HTTP è¯·æ±‚
  - `Pillow` - å›¾ç‰‡å¤„ç†
  - `python-dotenv` - ç¯å¢ƒå˜é‡ç®¡ç†

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLI å…¥å£ (cli.py)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ–‡æ¡£è§£æå™¨   â”‚  â”‚ å†…å®¹è½¬æ¢å™¨    â”‚  â”‚  å°é¢ç”Ÿæˆå™¨    â”‚  â”‚
â”‚  â”‚             â”‚â†’ â”‚              â”‚â†’ â”‚                â”‚  â”‚
â”‚  â”‚ MD/PDF/DOC  â”‚  â”‚ HTML+CSS     â”‚  â”‚ AI/æœç´¢/æ¨¡æ¿   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“                  â†“                â†“           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å›¾ç‰‡å¤„ç†å™¨   â”‚  â”‚ æ ·å¼åº”ç”¨å™¨    â”‚  â”‚  ç´ æä¸Šä¼ å™¨    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â†“             â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                  â”‚ å¾®ä¿¡å…¬ä¼—å·API    â”‚    â”‚
â”‚                                  â”‚ - ä¸Šä¼ ç´ æ       â”‚    â”‚
â”‚                                  â”‚ - åˆ›å»ºè‰ç¨¿       â”‚    â”‚
â”‚                                  â”‚ - æ›´æ–°è‰ç¨¿       â”‚    â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é¡¹ç›®ç›®å½•ç»“æ„

```
mp-weixin-skills/
â”œâ”€â”€ SKILL.md                 # Skill å®šä¹‰æ–‡ä»¶
â”œâ”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                # ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py               # CLI å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ exceptions.py        # å¼‚å¸¸å®šä¹‰
â”‚   â”œâ”€â”€ error_handler.py     # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ parsers/             # æ–‡æ¡£è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç±»å’Œå·¥å‚
â”‚   â”‚   â”œâ”€â”€ markdown.py      # Markdown è§£æ
â”‚   â”‚   â”œâ”€â”€ word.py          # Word è§£æ
â”‚   â”‚   â””â”€â”€ pdf.py           # PDF è§£æ
â”‚   â”œâ”€â”€ converters/          # å†…å®¹è½¬æ¢å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ html_builder.py  # HTML æ„å»º
â”‚   â”‚   â”œâ”€â”€ style_manager.py # æ ·å¼ç®¡ç†
â”‚   â”‚   â””â”€â”€ templates/       # æ ·å¼æ¨¡æ¿
â”‚   â”‚       â”œâ”€â”€ default.html
â”‚   â”‚       â”œâ”€â”€ modern.html
â”‚   â”‚       â”œâ”€â”€ classic.html
â”‚   â”‚       â”œâ”€â”€ tech.html
â”‚   â”‚       â””â”€â”€ minimal.html
â”‚   â”œâ”€â”€ covers/              # å°é¢ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç±»
â”‚   â”‚   â”œâ”€â”€ ai_generator.py  # AI ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ image_search.py  # å›¾åº“æœç´¢
â”‚   â”‚   â””â”€â”€ template_maker.py # æœ¬åœ°æ¨¡æ¿
â”‚   â”œâ”€â”€ media/               # åª’ä½“å¤„ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ processor.py     # å›¾ç‰‡å¤„ç†
â”‚   â”‚   â””â”€â”€ uploader.py      # ç´ æä¸Šä¼ 
â”‚   â”œâ”€â”€ wechat/              # å¾®ä¿¡å…¬ä¼—å· API
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api_client.py    # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ auth.py          # è®¤è¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ draft_manager.py # è‰ç¨¿ç®¡ç†
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ logger.py        # æ—¥å¿—ç®¡ç†
â”œâ”€â”€ examples/                # ç¤ºä¾‹æ–‡ä»¶
â”œâ”€â”€ scripts/                 # è¾…åŠ©è„šæœ¬
â”œâ”€â”€ templates/               # è¾“å‡ºæ¨¡æ¿
â””â”€â”€ docs/                    # æ–‡æ¡£
    â””â”€â”€ plans/               # è®¾è®¡æ–‡æ¡£
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 æ–‡æ¡£è§£ææ¨¡å—

#### ç»Ÿä¸€è§£ææ¥å£

```python
@dataclass
class ParsedContent:
    """è§£æåçš„å†…å®¹ç»“æ„"""
    title: str                      # æ–‡ç« æ ‡é¢˜
    content: str                    # æ­£æ–‡å†…å®¹ï¼ˆHTMLæ ¼å¼ï¼‰
    images: List[Path]              # æ–‡å†…å›¾ç‰‡è·¯å¾„åˆ—è¡¨
    metadata: dict                  # å…ƒæ•°æ®ï¼ˆä½œè€…ã€æ—¥æœŸç­‰ï¼‰
    toc: Optional[List[dict]]       # ç›®å½•ç»“æ„

class BaseParser(ABC):
    """è§£æå™¨åŸºç±»"""
    @abstractmethod
    def parse(self, file_path: Path) -> ParsedContent: pass

    @abstractmethod
    def supports(self, file_path: Path) -> bool: pass
```

#### è§£æå™¨å®ç°

| è§£æå™¨ | åº“ | æ”¯æŒæ ¼å¼ | åŠŸèƒ½ |
|--------|-----|----------|------|
| MarkdownParser | markdown-it-py | .md | GFMã€å…ƒæ•°æ®ã€å›¾ç‰‡æå– |
| WordParser | python-docx | .docx | æ ‡é¢˜ã€æ­£æ–‡ã€å›¾ç‰‡ã€æ ¼å¼ |
| PDFParser | PyMuPDF | .pdf | æ–‡æœ¬ã€å›¾ç‰‡ã€å¤šåˆ—å¸ƒå±€ |

### 3.2 å†…å®¹è½¬æ¢æ¨¡å—

#### HTML æ„å»ºå™¨

```python
class WechatHTMLBuilder:
    """å¾®ä¿¡å…¬ä¼—å· HTML æ„å»ºå™¨"""
    def build(self, parsed: ParsedContent) -> str:
        # 1. åº”ç”¨æ¨¡æ¿æ ·å¼
        # 2. è½¬æ¢å†…å®¹å…ƒç´ 
        # 3. å¤„ç†å›¾ç‰‡æ ‡ç­¾
        # 4. ç”Ÿæˆæœ€ç»ˆ HTML
        pass
```

#### æ ·å¼æ¨¡æ¿

æä¾› 5 ç§é¢„è®¾æ¨¡æ¿ï¼š

| æ¨¡æ¿ | é£æ ¼ | ç‰¹ç‚¹ |
|------|------|------|
| default | ç®€æ´ | é»˜è®¤é£æ ¼ï¼Œé€‚åˆå¤§å¤šæ•°å†…å®¹ |
| modern | ç°ä»£ | å¡ç‰‡é£æ ¼ï¼Œè§†è§‰å±‚æ¬¡åˆ†æ˜ |
| classic | ç»å…¸ | ä¼ ç»Ÿåª’ä½“é£æ ¼ï¼Œæ­£å¼æ„Ÿ |
| tech | æŠ€æœ¯ | ä»£ç å‹å¥½ï¼Œé€‚åˆæŠ€æœ¯æ–‡ç«  |
| minimal | æç®€ | æœ€å°åŒ–è®¾è®¡ï¼Œçªå‡ºå†…å®¹ |

### 3.3 å°é¢ç”Ÿæˆæ¨¡å—

#### ç»Ÿä¸€æ¥å£

```python
@dataclass
class CoverResult:
    """å°é¢ç”Ÿæˆç»“æœ"""
    image_path: Path           # ç”Ÿæˆçš„å›¾ç‰‡è·¯å¾„
    source_type: str           # æ¥æºç±»å‹ (ai/template/search)
    metadata: dict             # å…ƒæ•°æ®
    needs_upload: bool = True  # æ˜¯å¦éœ€è¦ä¸Šä¼ åˆ°å¾®ä¿¡

class BaseCoverGenerator(ABC):
    @abstractmethod
    def generate(self, title: str, content: str, **kwargs) -> CoverResult: pass
```

#### ç”Ÿæˆå™¨å®ç°

| ç”Ÿæˆå™¨ | ä¾èµ– | ç‰¹ç‚¹ |
|--------|------|------|
| AICoverGenerator | OpenAI/Midjourney API | AI åˆ›æ„ç”Ÿæˆ |
| ImageSearchCoverGenerator | Unsplash/Pexels API | é«˜è´¨é‡å›¾åº“ |
| TemplateCoverGenerator | Pillow/PIL | æœ¬åœ°æ¨¡æ¿ï¼Œå§‹ç»ˆå¯ç”¨ |

#### å°é¢è§„æ ¼

- å°ºå¯¸æ¯”ä¾‹ï¼š2.35:1
- æ¨èå°ºå¯¸ï¼š900Ã—383 æˆ– 1080Ã—460
- æ ¼å¼ï¼šJPG/PNG
- å¤§å°é™åˆ¶ï¼š< 5MBï¼ˆç¼©ç•¥å›¾ < 64KBï¼‰

### 3.4 å¾®ä¿¡å…¬ä¼—å· API é›†æˆ

#### API ç«¯ç‚¹

| åŠŸèƒ½ | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| è·å– token | /cgi-bin/token | è·å– access_token |
| ä¸Šä¼ ç´ æ | /cgi-bin/material/add_material | ä¸Šä¼ æ°¸ä¹…ç´ æ |
| åˆ›å»ºè‰ç¨¿ | /cgi-bin/draft/add | åˆ›å»ºè‰ç¨¿ |
| æ›´æ–°è‰ç¨¿ | /cgi-bin/draft/update | æ›´æ–°å·²æœ‰è‰ç¨¿ |

#### API å®¢æˆ·ç«¯

```python
class WechatApiClient:
    """å¾®ä¿¡å…¬ä¼—å· API å®¢æˆ·ç«¯"""

    def get_access_token(self) -> str:
        """è·å–è®¿é—®ä»¤ç‰Œ"""

    def upload_media(self, file_path: str, media_type: str = "thumb") -> Dict:
        """ä¸Šä¼ æ°¸ä¹…ç´ æ"""

    def upload_draft(self, articles: List[Dict]) -> Dict:
        """ä¸Šä¼ è‰ç¨¿"""

    def update_draft(self, media_id: str, index: int, article: Dict) -> Dict:
        """æ›´æ–°è‰ç¨¿"""
```

#### è‰ç¨¿ç®¡ç†

```python
@dataclass
class DraftMetadata:
    """è‰ç¨¿å…ƒæ•°æ®"""
    media_id: str
    title: str
    created_at: str
    updated_at: str
    file_path: Path
    cover_media_id: str = ""
    content_media_ids: List[str] = None

class DraftManager:
    """è‰ç¨¿ç®¡ç†å™¨ - è·Ÿè¸ªå’Œç®¡ç†å·²å‘å¸ƒçš„è‰ç¨¿"""
```

---

## 4. æ—¥å¿—ç³»ç»Ÿ

### 4.1 è®¾è®¡åŸåˆ™

1. **æ¸…æ™°æ ‡è¯†**: æ¯æ¡æ—¥å¿—å¸¦æ¨¡å—æ ‡ç­¾ `[ModuleName]`
2. **å½©è‰²è¾“å‡º**: æ§åˆ¶å°ä½¿ç”¨ ANSI é¢œè‰²åŒºåˆ†çº§åˆ«
3. **ç»“æ„åŒ–å­˜å‚¨**: æ–‡ä»¶æ—¥å¿—ä½¿ç”¨ JSON æ ¼å¼
4. **åˆ†çº§è®°å½•**: å¼€å‘æ—¶ DEBUGï¼Œç”Ÿäº§æ—¶ INFO

### 4.2 æ—¥å¿—çº§åˆ«ä½¿ç”¨

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|----------|------|
| DEBUG | è¯¦ç»†è°ƒè¯•ä¿¡æ¯ | å˜é‡å€¼ã€è°ƒç”¨å †æ ˆ |
| INFO | å…³é”®æ­¥éª¤ | æ¨¡å—å¼€å§‹/å®Œæˆã€API è°ƒç”¨ |
| WARNING | è­¦å‘Šä¿¡æ¯ | ä½¿ç”¨é»˜è®¤å€¼ã€å“åº”ç¼“æ…¢ |
| ERROR | é”™è¯¯ä¿¡æ¯ | æ“ä½œå¤±è´¥ã€å¼‚å¸¸ |
| CRITICAL | ä¸¥é‡é”™è¯¯ | ç¨‹åºæ— æ³•ç»§ç»­ |

### 4.3 è¾“å‡ºç¤ºä¾‹

```
2025-01-29 10:00:00 | INFO     | [CLI]       | å¾®ä¿¡å…¬ä¼—å·æ–‡ç« å‘å¸ƒå·¥å…·å¯åŠ¨
2025-01-29 10:00:01 | INFO     | [Parser]    | å¼€å§‹è§£ææ–‡ä»¶: article.md
2025-01-29 10:00:04 | INFO     | [WechatAPI] | ç´ æä¸Šä¼ æˆåŠŸ - media_id: xxxxx
2025-01-29 10:00:07 | INFO     | [CLI]       | âœ… æ–‡ç« å‘å¸ƒæˆåŠŸï¼
```

---

## 5. é”™è¯¯å¤„ç†

### 5.1 å¼‚å¸¸å±‚æ¬¡ç»“æ„

```
MpWeixinError (åŸºç±»)
â”œâ”€â”€ ParserError (è§£æé”™è¯¯)
â”‚   â”œâ”€â”€ UnsupportedFileTypeError
â”‚   â””â”€â”€ FileReadError
â”œâ”€â”€ CoverError (å°é¢é”™è¯¯)
â”‚   â”œâ”€â”€ NoCoverGeneratorAvailableError
â”‚   â””â”€â”€ AIGenerationError
â”œâ”€â”€ WechatApiError (API é”™è¯¯)
â”‚   â”œâ”€â”€ ApiConfigError
â”‚   â””â”€â”€ [å…·ä½“é”™è¯¯ç å¤„ç†]
â”œâ”€â”€ ConversionError (è½¬æ¢é”™è¯¯)
â”‚   â”œâ”€â”€ TemplateNotFoundError
â”‚   â””â”€â”€ ContentTooLongError
â””â”€â”€ NetworkError (ç½‘ç»œé”™è¯¯)
```

### 5.2 ç”¨æˆ·å‹å¥½æç¤º

æ¯ä¸ªå¼‚å¸¸éƒ½æä¾›ï¼š
- æ¸…æ™°çš„é”™è¯¯æè¿°
- å…·ä½“çš„åŸå› åˆ†æ
- å¯æ“ä½œçš„è§£å†³æ–¹æ¡ˆ

```python
# ç¤ºä¾‹ï¼šApiConfigError çš„ç”¨æˆ·æ¶ˆæ¯
âŒ å¾®ä¿¡å…¬ä¼—å· API é…ç½®ä¸å®Œæ•´

ç¼ºå°‘é…ç½®: WECHAT_APP_SECRET

è¯·æ£€æŸ¥ .env æ–‡ä»¶ï¼Œç¡®ä¿ä»¥ä¸‹é…ç½®å·²å¡«å†™ï¼š
- WECHAT_APP_ID
- WECHAT_APP_SECRET

ğŸ’¡ å¦‚æœä¸ä½¿ç”¨ APIï¼Œå¯ä»¥è¿è¡Œæ‰‹åŠ¨æ¨¡å¼ï¼š
   mp-weixin publish article.md --no-api
```

---

## 6. CLI å‘½ä»¤è®¾è®¡

### 6.1 ä¸»è¦å‘½ä»¤

```bash
# å‘å¸ƒæ–‡ç« 
mp-weixin publish <file> [options]

# æ›´æ–°å·²æœ‰è‰ç¨¿
mp-weixin update <media_id> [options]

# åˆ—å‡ºå·²å‘å¸ƒçš„è‰ç¨¿
mp-weixin list

# ä»…è½¬æ¢æ ¼å¼ï¼ˆä¸ä¸Šä¼ ï¼‰
mp-weixin convert <file> [options]
```

### 6.2 å¸¸ç”¨é€‰é¡¹

```bash
# å°é¢ç”Ÿæˆæ–¹å¼
--cover-type auto|ai|search|template

# æ ·å¼æ¨¡æ¿
--template default|modern|classic|tech|minimal

# ä¸»é¢˜é¢œè‰²
--theme-color #07c160

# æ˜¯å¦ä½¿ç”¨ API
--api/--no-api

# è¯¦ç»†è¾“å‡º
--verbose/-v

# ç¯å¢ƒæ–‡ä»¶
--env .env
```

### 6.3 ä½¿ç”¨ç¤ºä¾‹

```bash
# åŸºæœ¬ä½¿ç”¨
mp-weixin publish article.md

# ä½¿ç”¨ AI ç”Ÿæˆå°é¢
mp-weixin publish article.md --cover-type ai

# æ›´æ–°å·²æœ‰è‰ç¨¿
mp-weixin update <media_id>

# ä»…è½¬æ¢ä¸ä¸Šä¼ 
mp-weixin convert article.md --no-api
```

---

## 7. ç¯å¢ƒé…ç½®

### 7.1 .env é…ç½®æ–‡ä»¶

```bash
# å¾®ä¿¡å…¬ä¼—å·é…ç½®ï¼ˆå¿…éœ€ï¼Œä½¿ç”¨ API æ—¶ï¼‰
WECHAT_APP_ID=your_app_id
WECHAT_APP_SECRET=your_app_secret

# å°é¢ç”Ÿæˆé…ç½®ï¼ˆå¯é€‰ï¼‰
COVER_GENERATOR=auto
OPENAI_API_KEY=your_openai_key
UNSPLASH_API_KEY=your_unsplash_key

# è¾“å‡ºé…ç½®
OUTPUT_DIR=./output
TEMP_DIR=./temp

# æ ·å¼é…ç½®
TEMPLATE_NAME=default
THEME_COLOR=#07c160

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=./output/mp-weixin.log
```

### 7.2 æ‰‹åŠ¨æ¨¡å¼

å¦‚æœä¸é…ç½® API å‡­è¯ï¼Œå·¥å…·å°†è¿è¡Œåœ¨æ‰‹åŠ¨æ¨¡å¼ï¼š

1. ç”Ÿæˆ HTML å†…å®¹
2. ç”Ÿæˆå°é¢å›¾
3. ç”Ÿæˆç´ ææ¸…å•
4. è¾“å‡ºæ“ä½œæŒ‡å¼•

---

## 8. æ•°æ®æµå›¾

```mermaid
graph TD
    A[è¾“å…¥æ–‡æ¡£] --> B[æ–‡æ¡£è§£æå™¨]
    B --> C[ParsedContent]
    C --> D[å†…å®¹è½¬æ¢å™¨]
    C --> E[å°é¢ç”Ÿæˆå™¨]
    D --> F[HTMLå†…å®¹]
    E --> G[å°é¢å›¾ç‰‡]
    F --> H[APIå®¢æˆ·ç«¯?]
    G --> H
    H -->|æ˜¯| I[ä¸Šä¼ ç´ æ]
    H -->|å¦| J[è¾“å‡ºæœ¬åœ°æ–‡ä»¶]
    I --> K[åˆ›å»º/æ›´æ–°è‰ç¨¿]
    K --> L[è¿”å›media_id]
    J --> M[å®Œæˆ]
    L --> M
```

---

## 9. å®ç°è®¡åˆ’

### é˜¶æ®µä¸€ï¼šåŸºç¡€åŠŸèƒ½
1. é¡¹ç›®åˆå§‹åŒ–å’Œä¾èµ–å®‰è£…
2. æ–‡æ¡£è§£ææ¨¡å—ï¼ˆMD/PDF/Wordï¼‰
3. å†…å®¹è½¬æ¢æ¨¡å—
4. åŸºç¡€ CLI æ¡†æ¶

### é˜¶æ®µäºŒï¼šæ ·å¼å’Œå°é¢
1. æ ·å¼æ¨¡æ¿ç³»ç»Ÿ
2. æœ¬åœ°æ¨¡æ¿å°é¢ç”Ÿæˆ
3. å›¾åº“æœç´¢å°é¢ç”Ÿæˆ

### é˜¶æ®µä¸‰ï¼šAPI é›†æˆ
1. å¾®ä¿¡å…¬ä¼—å· API å®¢æˆ·ç«¯
2. ç´ æä¸Šä¼ åŠŸèƒ½
3. è‰ç¨¿åˆ›å»ºåŠŸèƒ½

### é˜¶æ®µå››ï¼šå¢å¼ºåŠŸèƒ½
1. è‰ç¨¿æ›´æ–°åŠŸèƒ½
2. AI å°é¢ç”Ÿæˆ
3. è‰ç¨¿ç®¡ç†å™¨
4. é”™è¯¯å¤„ç†ä¼˜åŒ–

### é˜¶æ®µäº”ï¼šæµ‹è¯•å’Œæ–‡æ¡£
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. ç”¨æˆ·æ–‡æ¡£
4. Skill å®šä¹‰

---

## 10. é£é™©å’Œç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| API å˜æ›´ | åŠŸèƒ½å¤±æ•ˆ | ç‰ˆæœ¬æ£€æŸ¥ã€å…¼å®¹æ€§æç¤º |
| å›¾ç‰‡ä¸Šä¼ å¤±è´¥ | å†…å®¹ä¸å®Œæ•´ | æ‰‹åŠ¨æ¨¡å¼å…œåº• |
| å°é¢ç”Ÿæˆå¤±è´¥ | æ— å°é¢ | å¤šç§ç”Ÿæˆæ–¹å¼ã€æœ¬åœ°æ¨¡æ¿ |
| å†…å®¹è¶…é•¿ | å‘å¸ƒå¤±è´¥ | é¢„æ£€æŸ¥ã€æç¤ºç”¨æˆ· |

---

## é™„å½•

### A. å¾®ä¿¡å…¬ä¼—å· API å‚è€ƒ

- [æ–°å¢æ°¸ä¹…ç´ æ](https://developers.weixin.qq.com/doc/subscription/api/material/permanent/api_addmaterial.html)
- [æ–°å¢è‰ç¨¿](https://developers.weixin.qq.com/doc/subscription/api/draftbox/draftmanage/api_draft_add.html)
- [æ›´æ–°è‰ç¨¿](https://developers.weixin.qq.com/doc/subscription/api/draftbox/draftmanage/api_draft_update.html)

### B. ä¾èµ–åº“ç‰ˆæœ¬

```
python-docx>=1.0.0
PyMuPDF>=1.23.0
markdown-it-py>=3.0.0
requests>=2.31.0
Pillow>=10.0.0
python-dotenv>=1.0.0
```

### C. å¼€å‘è§„èŒƒ

1. ä»£ç é£æ ¼ï¼šéµå¾ª PEP 8
2. ç±»å‹æ³¨è§£ï¼šä½¿ç”¨ Python 3.10+ ç±»å‹æ³¨è§£
3. æ–‡æ¡£å­—ç¬¦ä¸²ï¼šä½¿ç”¨ Google é£æ ¼
4. æµ‹è¯•è¦†ç›–ï¼šç›®æ ‡è¦†ç›–ç‡ > 80%
